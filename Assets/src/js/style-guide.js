global.jQuery = require('jquery');
global.$ = global.jQuery;

var StyleGuide = StyleGuide || {};

StyleGuide = {

	init: function () {
		this.makeTOC();
		this.updateTitle();
		this.smoothScroll();
	},

	makeTOC: function () {
		var itemTemplate  = "<li><a href='%url%'>%title%</a></li>",
			sectionHeads  = $(".sg-section > h2.sg"), // section headers generated by styledown
			toc           = $('#toc-list'), // defined in style.scss
			text          = [],
			links		  = [],
			items         = [],
			sectionsText  = function() {
				sectionHeads.each( function(i, el) {
					links.push(this.id); // collect ids
					text.push($(this).text()); // collect display text
				});
			};

		sectionsText(); // add section heading text to array
		links.shift(); // remove first item in array: "#table-of-contents"
		text.shift(); // remove first item in array: "Table of Contents"
		$.each(text,function(i,el){
			// build link template with actual values
			// url & title are the same section heading text
			var itemTmp = itemTemplate.replace(/%url%/, "#" + links[i]),
				item    = itemTmp.replace(/%title%/, el);
			// add them to list
			toc.append(item);
		});

	},

	updateTitle: function () {
		// change title tag value, becuase Styledown doesn't provide this option
		// see: https://github.com/styledown/styledown/issues/2
		var title = document.getElementsByTagName('title');
		$(title).text('Style Guide');
	},

	smoothScroll : function () {
		// simple smooth scrolling, for fanciness
		$('a[href*=#]:not([href=#])').click(function() {
			if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
				var target = $(this.hash);
				target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
				if (target.length) {
					$('html,body').animate({
						scrollTop: target.offset().top
					}, 500);

					return false;
				}
			}
		});
	}

};

StyleGuide.init();